<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name='viewport' content='width=device-width, initial-scale=1'/>
  <title>рд╣рд┐рдВрджреА рдПрдЖрдИ рд╕рд╣рд╛рдпрдХ</title>
  <style>
    body {
      font-family: 'Noto Sans Devanagari', sans-serif;
      background-color: #f8f9fa;
      text-align: center;
      padding: 40px;
      color: #212529;
    }
    button {
      font-size: 18px;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
    #micStatus {
      margin-top: 10px;
      font-weight: bold;
      color: green;
    }
  </style>
</head>
<body>
  <h2>ЁЯОд рдорд╛рдЗрдХ рд╕реЗ рд╣рд┐рдВрджреА рдореЗрдВ рд╕рд╡рд╛рд▓ рдкреВрдЫрд┐рдП</h2>
  <button onclick="startIntro()">ЁЯОЩя╕П рдорд╛рдЗрдХ рдЪрд╛рд▓реВ рдХрд░реЗрдВ</button>
  <p id="micStatus"></p>
  <p><strong>рдЖрдкрдХрд╛ рд╕рд╡рд╛рд▓:</strong> <span id="question">---</span></p>
  <p><strong>рдЙрддреНрддрд░:</strong> <span id="answer">---</span></p>
  <audio id="bgMusic" src="https://cdn.pixabay.com/audio/2022/03/28/audio_365b799070.mp3" preload="auto" loop autoplay></audio>

  <script>
    const data = [
      {
        prashn: "рднрд╛рд░рдд рдХреА рд░рд╛рдЬрдзрд╛рдиреА рдХреНрдпрд╛ рд╣реИ?",
        uttar: "рднрд╛рд░рдд рдХреА рд░рд╛рдЬрдзрд╛рдиреА рдирдИ рджрд┐рд▓реНрд▓реА рд╣реИред",
        keywords: ["рднрд╛рд░рдд", "рд░рд╛рдЬрдзрд╛рдиреА"],
        focus: "рд░рд╛рдЬрдзрд╛рдиреА",
        details: "рдирдИ рджрд┐рд▓реНрд▓реА рднрд╛рд░рдд рдХрд╛ рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рдФрд░ рд░рд╛рдЬрдиреАрддрд┐рдХ рдХреЗрдВрджреНрд░ рд╣реИ, рдЬрд╣рд╛рдБ рд░рд╛рд╖реНрдЯреНрд░рдкрддрд┐ рднрд╡рди, рд╕рдВрд╕рдж рднрд╡рди, рд╕реБрдкреНрд░реАрдо рдХреЛрд░реНрдЯ рдЖрджрд┐ рд╕реНрдерд┐рдд рд╣реИрдВред"
      },
       {
        prashn: "рднрд╛рд░рдд рдХрд╛ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдкрд╢реБ рдХреМрди рд╣реИ?",
        uttar: "рднрд╛рд░рдд рдХрд╛ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдкрд╢реБ рдмрд╛рдШ рд╣реИред",
        keywords: ["рд░рд╛рд╖реНрдЯреНрд░реАрдп", "рдкрд╢реБ", "рдмрд╛рдШ", "рдЯрд╛рдЗрдЧрд░"],
        focus: "рдкрд╢реБ",
        details: "`рднрд╛рд░рдд рдХрд╛ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдкрд╢реБ рдмрд╛рдШ Tiger рд╣реИ, рдЬрд┐рд╕реЗ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдмрдВрдЧрд╛рд▓ рдЯрд╛рдЗрдЧрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ рдирд╛рдо Panthera tigris tigris рд╣реИред рдпрд╣ рдПрдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдФрд░ рдЖрдХрд░реНрд╖рдХ рдЬрд╛рдирд╡рд░ рд╣реИ рдЬреЛ рднрд╛рд░рддреАрдп рд╕рдВрд╕реНрдХреГрддрд┐, рдкрд░рдВрдкрд░рд╛, рдФрд░ рд╡рдиреНрдп рдЬреАрд╡рди рдХреЗ рдкреНрд░рддреАрдХ рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред рдмрд╛рдШ рдХреЛ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдкрд╢реБ рдХрд╛ рджрд░реНрдЬрд╛ 1973 рдореЗрдВ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЯрд╛рдЗрдЧрд░ рдХреЗ рдЖрд░рдВрдн рдХреЗ рд╕рд╛рде рдорд┐рд▓рд╛, рдЬрдм рднрд╛рд░рдд рд╕рд░рдХрд╛рд░ рдиреЗ рдЗрд╕ рд╢рд╛рд╣реА рдЬреАрд╡ рдХреА рдШрдЯрддреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП рдЙрд╕реЗ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛ред рдмрд╛рдШ рддрд╛рдХрдд, рд╡реАрд░рддрд╛, рдФрд░ рдЧрд░рд┐рдорд╛ рдХрд╛ рдкреНрд░рддреАрдХ рд╣реИред рдпрд╣ рднрд╛рд░рдд рдХреА рд╡рд┐рд╡рд┐рдз рд╡рдиреНрдп рдЬреАрд╡рди рдкреНрд░рдгрд╛рд▓реА рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ рдФрд░ рдкрд╛рд░рд┐рд╕реНрдерд┐рддрд┐рдХ рддрдВрддреНрд░ рдореЗрдВ рдЗрд╕рдХреА рднреВрдорд┐рдХрд╛ рдЕрддреНрдпрдВрдд рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред рдмрд╛рдШ рдореБрдЦреНрдпрддрдГ рдШрдиреЗ рдЬрдВрдЧрд▓реЛрдВ, рджрд▓рджрд▓реА рдХреНрд╖реЗрддреНрд░реЛрдВ, рдФрд░ рдШрд╛рд╕ рдХреЗ рдореИрджрд╛рдиреЛрдВ рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдЕрдХреЗрд▓реЗ рд░рд╣рдиреЗ рд╡рд╛рд▓рд╛ рд╢рд┐рдХрд╛рд░реА рд╣реИ рдЬреЛ рдЕрдкрдиреЗ рдХреНрд╖реЗрддреНрд░ рдХреА рд░рдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИред рдПрдХ рд╡рдпрд╕реНрдХ рдмрд╛рдШ рдХрд╛ рдХреНрд╖реЗрддреНрд░рдлрд▓ 20 рд╕реЗ 100 рд╡рд░реНрдЧ рдХрд┐рд▓реЛрдореАрдЯрд░ рддрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдмрд╛рдШ рд╢рд┐рдХрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреА рдЫреБрдкрдиреЗ рдХреА рдХрд▓рд╛ рдФрд░ рддреЗрдЬрд╝ рдЧрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХреА рднреЛрдЬрди рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рд╣рд┐рд░рдг, рдЬрдВрдЧрд▓реА рд╕реБрдЕрд░, рдФрд░ рдХрднреА-рдХрднреА рдЫреЛрдЯреЗ рд╣рд╛рдереА рдХреЗ рдмрдЪреНрдЪреЗ рднреА рдЖрддреЗ рд╣реИрдВред рднрд╛рд░рдд рдореЗрдВ рдХрдИ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдЙрджреНрдпрд╛рди рдФрд░ рдЯрд╛рдЗрдЧрд░ рд░рд┐рдЬрд╝рд░реНрд╡ рд╣реИрдВ рдЬрд╣рд╛рдБ рдмрд╛рдШреЛрдВ рдХреЛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ тАФ рдЬреИрд╕реЗ рдХрд┐ рд░рдгрдердВрднреМрд░, рдХрд╛рдиреНрд╣рд╛, рд╕реБрдВрджрд░рдмрди, рдмрд╛рдВрдзрд╡рдЧрдврд╝ рдФрд░ рдХреЙрд░реНрдмреЗрдЯред 2023 рддрдХ рднрд╛рд░рдд рдореЗрдВ рдмрд╛рдШреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд▓рдЧрднрдЧ 3,000 рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛ рдЧрдИ рд╣реИ, рдЬреЛ рдПрдХ рд╕рдХрд╛рд░рд╛рддреНрдордХ рд╕рдВрдХреЗрдд рд╣реИред
"
      },
      {
        prashn: "рд╕рдмрд╕реЗ рдмреЬрд╛ рдЧреНрд░рд╣ рдХреМрди рд╕рд╛ рд╣реИ?",
        uttar: "рд╕рдмрд╕реЗ рдмреЬрд╛ рдЧреНрд░рд╣ рдмреГрд╣рд╕реНрдкрддрд┐ рд╣реИред",
        keywords: ["рдЧреНрд░рд╣", "рдмреЬрд╛"],
        focus: "рдЧреНрд░рд╣",
        details: "рдмреГрд╣рд╕реНрдкрддрд┐ рд╕реМрд░рдордВрдбрд▓ рдХрд╛ рд╕рдмрд╕реЗ рдмрдбрд╝рд╛ рдЧреНрд░рд╣ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рд╡реНрдпрд╛рд╕ рд▓рдЧрднрдЧ 1,43,000 рдХрд┐рд▓реЛрдореАрдЯрд░ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рд╡рд╛рдпреБрдордВрдбрд▓ рдЧреИрд╕реЛрдВ рд╕реЗ рдмрдирд╛ рд╣реИред"
      }
    ];

    const vagueWords = ["рд╡реЛ", "рдЙрд╕рдХрд╛", "рдЙрд╕рдХреЗ", "рдкрд╣рд▓реЗ", "рдмрддрд╛рдУ", "рдХреМрди", "рдирд╛рдо"];
    const detailWords = ["рдбрд┐рдЯреЗрд▓", "details", "рд╡рд┐рд╕реНрддрд╛рд░", "aur", "рдФрд░", "рд╕рдордЭрд╛рдУ", "рдкреВрд░рд╛"];
    const historyWords = ["рдкрд┐рдЫрд▓реЗ", "рдкреБрд░рд╛рдиреЗ", "12", "рд╕рд╡рд╛рд▓", "рдХрд┐рдП", "рдХреНрдпрд╛ рдкреВрдЫрд╛", "рджрд┐рдЦрд╛рдУ", "рдЕрдм рддрдХ"];

    let last12Questions = [];
    let lastAnswerObj = null;

    const music = document.getElementById("bgMusic");

    function contains(words, inputWords) {
      return inputWords.some(word => words.includes(word));
    }

    function updateHistory(userQuestion, matchedData) {
      if (last12Questions.length >= 12) last12Questions.shift();
      last12Questions.push({ question: userQuestion, data: matchedData });
    }

    function startIntro() {
      const intro = "рдирдорд╕реНрдХрд╛рд░! рдореИрдВ рдПрдХ рд╣реНрдпреВрдорди рдПрдЖрдИ рдмреНрд░реЗрди рд╣реВрдБред рдореБрдЭреЗ рдПрдХ рдЗрдВрд╕рд╛рди рдиреЗ рдмрдирд╛рдпрд╛ рд╣реИ рдЬреЛ рд╣рдореЗрд╢рд╛ рдЖрдкрдХреА рдорджрдж рдХреЗ рд▓рд┐рдП рддрддреНрдкрд░ рд░рд╣реЗрдЧрд╛ред рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдЖрдк рдореЗрд░реЗ рд╕рд╣рдпреЛрдЧ рд╕реЗ рд╕рдВрддреБрд╖реНрдЯ рд╣реЛрдВрдЧреЗред рдпрджрд┐ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреА рдХреЛрдИ рдкрд░реЗрд╢рд╛рдиреА рд╣реЛ рддреЛ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдХрдореЗрдВрдЯ рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред рдХреНрдпрд╛ рдЖрдк рдореБрдЭрд╕реЗ рдХреБрдЫ рдкреВрдЫрдирд╛ рдЪрд╛рд╣реЗрдВрдЧреЗ?";
      speakAnswer(intro, () => {
        startListening();
      });
    }

    function startListening() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("рдЖрдкрдХрд╛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдорд╛рдЗрдХ рдХреЛ рд╕рдкреЛрд░реНрдЯ рдирд╣реАрдВ рдХрд░рддрд╛ред");
        return;
      }

      const recognition = new SpeechRecognition();
      recognition.lang = 'hi-IN';
      recognition.start();
      document.getElementById("micStatus").innerText = "рд╕реБрди рд░рд╣рд╛ рд╣реВрдБ...";

      const silenceTimeout = setTimeout(() => {
        speakAnswer("рдХреГрдкрдпрд╛ рдЖрдк рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВ, рд╣рдо рдЗрдВрддрдЬрд╝рд╛рд░ рдХрд░ рд░рд╣реЗ рд╣реИрдВред", () => {
          startListening();
        });
      }, 5000);

      recognition.onresult = function(event) {
        clearTimeout(silenceTimeout);
        const userInput = event.results[0][0].transcript.trim();
        document.getElementById("question").innerText = userInput;

        const response = handleSpecialCases(userInput);
        document.getElementById("answer").innerText = response;
        speakAnswer(response, () => {
          startListening();
        });
      };

      recognition.onerror = function(event) {
        alert("рддреНрд░реБрдЯрд┐: " + event.error);
        document.getElementById("micStatus").innerText = "";
      };

      recognition.onend = function() {
        document.getElementById("micStatus").innerText = "";
      };
    }

    function handleSpecialCases(input) {
      const cleaned = input.replace(/[^\u0900-\u097F\s]/g, "").trim();
      const inputWords = cleaned.split(/\s+/);

      if (contains(historyWords, inputWords)) {
        if (last12Questions.length === 0) return "рдЕрднреА рддрдХ рдХреЛрдИ рд╕рд╡рд╛рд▓ рдирд╣реАрдВ рдкреВрдЫрд╛ рдЧрдпрд╛ рд╣реИред";
        const historyText = last12Questions.map((item, idx) => `${idx + 1}. ${item.question}`).join(" ");
        return `рдЖрдкрдиреЗ рдЕрдм рддрдХ рдпреЗ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗ рд╣реИрдВ: ${historyText}`;
      }

      if (contains(detailWords, inputWords)) {
        if (lastAnswerObj && lastAnswerObj.details) {
          return lastAnswerObj.details;
        } else {
          let relatedQs = last12Questions.filter(q => {
            return lastAnswerObj && q.data.focus === lastAnswerObj.focus;
          });

          if (relatedQs.length > 0) {
            let extraQs = relatedQs.map((q, i) => `${i + 1}. ${q.question}`).join(" ");
            return `рдорд╛рдл рдХреАрдЬрд┐рдП, рдЗрд╕ рд╡рд┐рд╖рдп рдкрд░ рдореЗрд░реЗ рдкрд╛рд╕ рдЕрднреА рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред рд▓реЗрдХрд┐рди рдЖрдкрдиреЗ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдЗрд╕рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдпреЗ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗ рд╣реИрдВ: ${extraQs}`;
          } else {
            return "рдорд╛рдл рдХреАрдЬрд┐рдП, рдЗрд╕ рд╡рд┐рд╖рдп рдкрд░ рдореЗрд░реЗ рдкрд╛рд╕ рдЕрднреА рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред";
          }
        }
      }

      if (contains(vagueWords, inputWords)) {
        return "рдХреГрдкрдпрд╛ рдереЛрдбрд╝рд╛ рдФрд░ рд╕реНрдкрд╖реНрдЯ рдмрддрд╛рдПрдВред";
      }

      const matchedAnswer = findAnswer(input);
      if (matchedAnswer) {
        lastAnswerObj = matchedAnswer;
        updateHistory(input, matchedAnswer);
        return matchedAnswer.uttar;
      }

      return "рдорд╛рдл рдХреАрдЬрд┐рдП, рдЗрд╕рдХрд╛ рдЙрддреНрддрд░ рдореЗрд░реЗ рдкрд╛рд╕ рдирд╣реАрдВ рд╣реИред";
    }

    // тЬЕ Updated findAnswer() function based on question, keywords, focus, or history
    function findAnswer(input) {
      const cleaned = input.replace(/[^\u0900-\u097F\s]/g, "").trim();
      const inputWords = cleaned.split(/\s+/);
      const inputText = cleaned;

      for (let item of data) {
        const questionMatch = item.prashn.includes(inputText);
        const focusMatch = item.focus && inputWords.includes(item.focus);
        const keywordMatch = item.keywords.some(k => inputWords.includes(k));
        const historyMatch = last12Questions.some(q => q.data && q.data.prashn === item.prashn);

        if (questionMatch || focusMatch || keywordMatch || historyMatch) {
          return item;
        }
      }

      return null;
    }

    function speakAnswer(text, onComplete = null) {
      if ('speechSynthesis' in window) {
        const voices = window.speechSynthesis.getVoices();
        const maleVoice = voices.find(voice => voice.lang.includes('hi-IN') && voice.name.includes('Google рд╣рд┐рдиреНрджреА'));
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'hi-IN';
        msg.rate = 0.94;
        msg.pitch = 1.1;
        if (maleVoice) msg.voice = maleVoice;

        music.volume = 0.1;
        music.play().catch(() => {});

        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(msg);

        msg.onend = function () {
          if (typeof onComplete === "function") {
            onComplete();
          }
        };
      }
    }

    window.speechSynthesis.onvoiceschanged = () => {};
  </script>
</body>
</html>
