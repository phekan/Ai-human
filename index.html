<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name='viewport' content='width=device-width, initial-scale=1'/>
  <title>рд╣рд┐рдВрджреА рдПрдЖрдИ рд╕рд╣рд╛рдпрдХ</title>
  <style>
    body {
      font-family: 'Noto Sans Devanagari', sans-serif;
      background-color: #f8f9fa;
      text-align: center;
      padding: 40px;
      color: #212529;
    }
    button {
      font-size: 18px;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
    #micStatus {
      margin-top: 10px;
      font-weight: bold;
      color: green;
    }
  </style>
</head>
<body>
  <h2>ЁЯОд рдорд╛рдЗрдХ рд╕реЗ рд╣рд┐рдВрджреА рдореЗрдВ рд╕рд╡рд╛рд▓ рдкреВрдЫрд┐рдП</h2>
  <button onclick="startIntro()">ЁЯОЩя╕П рдорд╛рдЗрдХ рдЪрд╛рд▓реВ рдХрд░реЗрдВ</button>
  <p id="micStatus"></p>
  <p><strong>рдЖрдкрдХрд╛ рд╕рд╡рд╛рд▓:</strong> <span id="question">---</span></p>
  <p><strong>рдЙрддреНрддрд░:</strong> <span id="answer">---</span></p>
  <audio id="bgMusic" src="https://cdn.pixabay.com/audio/2022/03/28/audio_365b799070.mp3" preload="auto" loop autoplay></audio>

  <script>
    const data = [
      {
    prashn: "рднрд╛рд░рдд рдХреА рд░рд╛рдЬрдзрд╛рдиреА рдХреНрдпрд╛ рд╣реИ?",
    uttar: "рднрд╛рд░рдд рдХреА рд░рд╛рдЬрдзрд╛рдиреА рдирдИ рджрд┐рд▓реНрд▓реА рд╣реИред",
    keywords: ["рднрд╛рд░рдд", "рд░рд╛рдЬрдзрд╛рдиреА"],
    focus: "рд░рд╛рдЬрдзрд╛рдиреА",
    details: "рдирдИ рджрд┐рд▓реНрд▓реА рднрд╛рд░рдд рдХрд╛ рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рдФрд░ рд░рд╛рдЬрдиреАрддрд┐рдХ рдХреЗрдВрджреНрд░ рд╣реИ, рдЬрд╣рд╛рдБ рд░рд╛рд╖реНрдЯреНрд░рдкрддрд┐ рднрд╡рди, рд╕рдВрд╕рдж рднрд╡рди, рд╕реБрдкреНрд░реАрдо рдХреЛрд░реНрдЯ рдЖрджрд┐ рд╕реНрдерд┐рдд рд╣реИрдВред"
  },
  {
    prashn: "рднрд╛рд░рдд рдХрд╛ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдкрд╢реБ рдХреМрди рд╣реИ?",
    uttar: "рднрд╛рд░рдд рдХрд╛ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдкрд╢реБ рдмрд╛рдШ рд╣реИред",
    keywords: ["рд░рд╛рд╖реНрдЯреНрд░реАрдп", "рдкрд╢реБ", "рдмрд╛рдШ", "рдЯрд╛рдЗрдЧрд░"],
    focus: "рдкрд╢реБ",
    details: "рднрд╛рд░рдд рдХрд╛ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдкрд╢реБ рдмрд╛рдШ (Tiger) рд╣реИ, рдЬрд┐рд╕реЗ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдмрдВрдЧрд╛рд▓ рдЯрд╛рдЗрдЧрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ рдирд╛рдо Panthera tigris tigris рд╣реИред рдпрд╣ рдПрдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдФрд░ рдЖрдХрд░реНрд╖рдХ рдЬрд╛рдирд╡рд░ рд╣реИ рдЬреЛ рднрд╛рд░рддреАрдп рд╕рдВрд╕реНрдХреГрддрд┐, рдкрд░рдВрдкрд░рд╛, рдФрд░ рд╡рдиреНрдп рдЬреАрд╡рди рдХрд╛ рдкреНрд░рддреАрдХ рд╣реИред рдмрд╛рдШ рдХреЛ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдкрд╢реБ рдХрд╛ рджрд░реНрдЬрд╛ 1973 рдореЗрдВ 'Project Tiger' рдХреЗ рдЖрд░рдВрдн рдХреЗ рд╕рд╛рде рдорд┐рд▓рд╛ред рдпрд╣ рдЕрдХреЗрд▓реЗ рд░рд╣рдиреЗ рд╡рд╛рд▓рд╛ рд╢рд┐рдХрд╛рд░реА рд╣реИ, рдФрд░ рдЗрд╕рдХрд╛ рдХреНрд╖реЗрддреНрд░рдлрд▓ 20 рд╕реЗ 100 рд╡рд░реНрдЧ рдХрд┐рдореА рддрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рднрд╛рд░рдд рдореЗрдВ рдкреНрд░рдореБрдЦ рдЯрд╛рдЗрдЧрд░ рд░рд┐рдЬрд╝рд░реНрд╡ рд╣реИрдВ: рд░рдгрдердВрднреМрд░, рдХрд╛рдиреНрд╣рд╛, рд╕реБрдВрджрд░рдмрди, рдмрд╛рдВрдзрд╡рдЧрдврд╝, рдФрд░ рдХреЙрд░реНрдмреЗрдЯред 2023 рддрдХ рдмрд╛рдШреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд▓рдЧрднрдЧ 3,000 рддрдХ рдкрд╣реБрдБрдЪ рдЧрдИ рд╣реИред"
  },
  {
    prashn: "рд╕рдмрд╕реЗ рдмреЬрд╛ рдЧреНрд░рд╣ рдХреМрди рд╕рд╛ рд╣реИ?",
    uttar: "рд╕рдмрд╕реЗ рдмреЬрд╛ рдЧреНрд░рд╣ рдмреГрд╣рд╕реНрдкрддрд┐ рд╣реИред",
    keywords: ["рдЧреНрд░рд╣", "рдмреЬрд╛"],
    focus: "рдЧреНрд░рд╣",
    details: "рдмреГрд╣рд╕реНрдкрддрд┐ рд╕реМрд░рдордВрдбрд▓ рдХрд╛ рд╕рдмрд╕реЗ рдмрдбрд╝рд╛ рдЧреНрд░рд╣ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рд╡реНрдпрд╛рд╕ рд▓рдЧрднрдЧ 1,43,000 рдХрд┐рд▓реЛрдореАрдЯрд░ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рд╡рд╛рдпреБрдордВрдбрд▓ рдореБрдЦреНрдпрддрдГ рд╣рд╛рдЗрдбреНрд░реЛрдЬрди рдФрд░ рд╣реАрд▓рд┐рдпрдо рдЧреИрд╕ рд╕реЗ рдмрдирд╛ рд╣реИред рдЗрд╕рдХрд╛ рдмрдбрд╝рд╛ рдЖрдХрд╛рд░, рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдЪреБрдореНрдмрдХреАрдп рдХреНрд╖реЗрддреНрд░ рдФрд░ рдХрдИ рдЪрдВрджреНрд░рдорд╛ рдЗрд╕реЗ рд╡рд┐рд╢реЗрд╖ рдмрдирд╛рддреЗ рд╣реИрдВред"
  },
  {
    prashn: "рднрд╛рд░рдд рдХреЗ рдкрд╣рд▓реЗ рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА рдХреМрди рдереЗ?",
    uttar: "рднрд╛рд░рдд рдХреЗ рдкрд╣рд▓реЗ рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА рдкрдВрдбрд┐рдд рдЬрд╡рд╛рд╣рд░рд▓рд╛рд▓ рдиреЗрд╣рд░реВ рдереЗред",
    keywords: ["рднрд╛рд░рдд", "рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА", "рдкрд╣рд▓реЗ"],
    focus: "рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА",
    details: "рдкрдВрдбрд┐рдд рдиреЗрд╣рд░реВ рднрд╛рд░рддреАрдп рд╕реНрд╡рддрдВрддреНрд░рддрд╛ рд╕рдВрдЧреНрд░рд╛рдо рдХреЗ рдорд╣рд╛рди рдиреЗрддрд╛ рдереЗ рдФрд░ 15 рдЕрдЧрд╕реНрдд 1947 рдХреЛ рднрд╛рд░рдд рдХреЗ рдкрд╣рд▓реЗ рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА рдмрдиреЗред рдЙрдиреНрд╣реЛрдВрдиреЗ рд▓реЛрдХрддрдВрддреНрд░, рд╕рдорд╛рдЬрд╡рд╛рдж, рдзрд░реНрдордирд┐рд░рдкреЗрдХреНрд╖рддрд╛ рдФрд░ рд╡рд┐рдЬреНрдЮрд╛рди рдХреЗ рд╕рд┐рджреНрдзрд╛рдВрддреЛрдВ рдХреЛ рдЖрдЧреЗ рдмрдврд╝рд╛рдпрд╛ред"
  }
];

const synonyms = {
  "pm": "рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА",
  "рдкреАрдПрдо": "рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА",
  "minister": "рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА",
  "рдиреЗрддрд╛": "рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА",
  "рдЯрд╛рдЗрдЧрд░": "рдмрд╛рдШ",
  "рдПрдирд┐рдорд▓": "рдкрд╢реБ",
  "рд╕рд┐рдЯреА": "рд░рд╛рдЬрдзрд╛рдиреА",
  "рджреЗрд╢": "рднрд╛рд░рдд"
};

const vagueWords = ["рд╡реЛ", "рдЙрд╕рдХрд╛", "рдЙрд╕рдХреЗ", "рдкрд╣рд▓реЗ", "рдмрддрд╛рдУ", "рдХреМрди", "рдирд╛рдо"];
const detailWords = ["рдбрд┐рдЯреЗрд▓", "details", "рд╡рд┐рд╕реНрддрд╛рд░", "aur", "рдФрд░", "рд╕рдордЭрд╛рдУ", "рдкреВрд░рд╛"];
const historyWords = ["рдкрд┐рдЫрд▓реЗ", "рдкреБрд░рд╛рдиреЗ", "12", "рд╕рд╡рд╛рд▓", "рдХрд┐рдП", "рдХреНрдпрд╛ рдкреВрдЫрд╛", "рджрд┐рдЦрд╛рдУ", "рдЕрдм рддрдХ"];

let last12Questions = [];
let lastAnswerObj = null;

const music = document.getElementById("bgMusic");

const normalizedSynonyms = Object.fromEntries(
  Object.entries(synonyms).map(([k, v]) => [k.toLowerCase(), v])
);

function normalizeInput(text) {
  return text.replace(/[^\u0900-\u097F\sa-zA-Z]/g, "")
    .toLowerCase().trim().split(/\s+/)
    .map(word => normalizedSynonyms[word] || word);
}

function fuzzyMatch(word1, word2) {
  return word1.includes(word2) || word2.includes(word1);
}

function contains(words, inputWords) {
  return inputWords.some(word => words.includes(word));
}

function updateHistory(userQuestion, matchedData) {
  if (last12Questions.length >= 12) last12Questions.shift();
  last12Questions.push({ question: userQuestion, data: matchedData });
}

function startIntro() {
  const intro = "рдирдорд╕реНрдХрд╛рд░! рдореИрдВ рдПрдХ рдПрдЖрдИ рд╕рд╣рд╛рдпрдХ рд╣реВрдБред рдХреГрдкрдпрд╛ рд╣рд┐рдВрджреА рдореЗрдВ рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВред";
  speakAnswer(intro, () => {
    startListening();
  });
}

function startListening() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    alert("рдЖрдкрдХрд╛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдорд╛рдЗрдХ рдХреЛ рд╕рдкреЛрд░реНрдЯ рдирд╣реАрдВ рдХрд░рддрд╛ред");
    return;
  }

  const recognition = new SpeechRecognition();
  recognition.lang = 'hi-IN';
  recognition.start();
  document.getElementById("micStatus").innerText = "ЁЯОз рд╕реБрди рд░рд╣рд╛ рд╣реВрдБ...";

  const silenceTimeout = setTimeout(() => {
    speakAnswer("рдХреГрдкрдпрд╛ рдЖрдк рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВ, рд╣рдо рдЗрдВрддрдЬрд╝рд╛рд░ рдХрд░ рд░рд╣реЗ рд╣реИрдВред", () => {
      startListening();
    });
  }, 7000);

  recognition.onresult = function(event) {
    clearTimeout(silenceTimeout);
    const userInput = event.results[0][0].transcript.trim();
    document.getElementById("question").innerText = userInput;

    const response = handleSpecialCases(userInput);
    document.getElementById("answer").innerText = response;
    speakAnswer(response, () => {
      startListening();
    });
  };

  recognition.onerror = function(event) {
    alert("рддреНрд░реБрдЯрд┐: " + event.error);
    document.getElementById("micStatus").innerText = "";
  };

  recognition.onend = function() {
    document.getElementById("micStatus").innerText = "";
  };
}

function handleSpecialCases(input) {
  const inputWords = normalizeInput(input);

  if (contains(historyWords, inputWords)) {
    if (last12Questions.length === 0) return "рдЕрднреА рддрдХ рдХреЛрдИ рд╕рд╡рд╛рд▓ рдирд╣реАрдВ рдкреВрдЫрд╛ рдЧрдпрд╛ рд╣реИред";
    const historyText = last12Questions.map((item, idx) => `${idx + 1}. ${item.question}`).join(" ");
    return `рдЖрдкрдиреЗ рдЕрдм рддрдХ рдпреЗ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗ рд╣реИрдВ: ${historyText}`;
  }

  if (contains(detailWords, inputWords)) {
    if (lastAnswerObj?.details) return lastAnswerObj.details;
    return "рдЗрд╕ рд╡рд┐рд╖рдп рдкрд░ рдХреЛрдИ рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдирдХрд╛рд░реА рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред";
  }

  if (contains(vagueWords, inputWords)) {
    return "рдХреГрдкрдпрд╛ рд╕рд╡рд╛рд▓ рдХреЛ рдереЛреЬрд╛ рдФрд░ рд╕реНрдкрд╖реНрдЯ рдХрд░реЗрдВред";
  }

  const matchedAnswer = findAnswer(inputWords);
  if (matchedAnswer) {
    lastAnswerObj = matchedAnswer;
    updateHistory(input, matchedAnswer);
    return matchedAnswer.uttar;
  }

  return "рдорд╛рдл рдХреАрдЬрд┐рдП, рдЗрд╕рдХрд╛ рдЙрддреНрддрд░ рдореЗрд░реЗ рдкрд╛рд╕ рдирд╣реАрдВ рд╣реИред";
}

function findAnswer(inputWords) {
  for (let item of data) {
    const questionWords = normalizeInput(item.prashn);
    const keywords = item.keywords.map(k => normalizedSynonyms[k] || k.toLowerCase());
    const focus = normalizedSynonyms[item.focus] || item.focus.toLowerCase();

    const questionMatch = inputWords.some(iw => questionWords.some(qw => fuzzyMatch(iw, qw)));
    const keywordMatch = inputWords.some(iw => keywords.some(kw => fuzzyMatch(iw, kw)));
    const focusMatch = inputWords.some(iw => fuzzyMatch(iw, focus));
    const historyMatch = last12Questions.some(q => q.data?.prashn === item.prashn);

    if (questionMatch || keywordMatch || focusMatch || historyMatch) {
      return item;
    }
  }
  return null;
}

function speakAnswer(text, onComplete = null) {
  if ('speechSynthesis' in window) {
    const voices = speechSynthesis.getVoices();
    const voice = voices.find(v => v.lang.includes('hi-IN')) || null;
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = 'hi-IN';
    msg.rate = 0.95;
    msg.pitch = 1.1;
    if (voice) msg.voice = voice;

    music.volume = 0.1;
    music.play().catch(() => {});

    speechSynthesis.cancel();
    speechSynthesis.speak(msg);

    msg.onend = function () {
      if (typeof onComplete === "function") onComplete();
    };
  }
}

window.speechSynthesis.onvoiceschanged = () => {};
  </script>
</body>
</html>
